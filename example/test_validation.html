<!DOCTYPE html>
<html>
<head>
    <title>SuperSonic Validation Tests</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background: #dfd; }
        .fail { background: #fdd; }
        pre { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>SuperSonic Configuration Validation Tests</h1>
    <div id="results"></div>

    <script type="module">
        import { SuperSonic } from './dist/supersonic.js';

        const results = document.getElementById('results');

        function addTest(name, testFn) {
            const div = document.createElement('div');
            div.className = 'test';

            try {
                testFn();
                div.className += ' fail';
                div.innerHTML = `<strong>[FAIL] ${name}</strong><pre>Expected error but none was thrown</pre>`;
            } catch (error) {
                div.className += ' pass';
                div.innerHTML = `<strong>[PASS] ${name}</strong><pre>${error.message}</pre>`;
            }

            results.appendChild(div);
        }

        function addValidTest(name, options) {
            const div = document.createElement('div');
            div.className = 'test';

            try {
                new SuperSonic(options);
                div.className += ' pass';
                div.innerHTML = `<strong>[PASS] ${name}</strong><pre>Valid configuration accepted</pre>`;
            } catch (error) {
                div.className += ' fail';
                div.innerHTML = `<strong>[FAIL] ${name}</strong><pre>Should not have thrown: ${error.message}</pre>`;
            }

            results.appendChild(div);
        }

        // Test 1: Invalid numBuffers (negative)
        addTest('Negative numBuffers', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { numBuffers: -1 }
            });
        });

        // Test 2: Invalid numBuffers (not a number)
        addTest('Non-numeric numBuffers', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { numBuffers: "lots" }
            });
        });

        // Test 3: numBuffers exceeds maximum
        addTest('numBuffers exceeds maximum', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { numBuffers: 100000 }
            });
        });

        // Test 4: Invalid bufLength (must be 128)
        addTest('bufLength not 128', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { bufLength: 256 }
            });
        });

        // Test 5: Invalid preferredSampleRate (out of range)
        addTest('preferredSampleRate out of range', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { preferredSampleRate: 500000 }
            });
        });

        // Test 6: Invalid realTime (not boolean)
        addTest('realTime not boolean', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { realTime: "yes" }
            });
        });

        // Test 7: Zero numBuffers
        addTest('Zero numBuffers', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { numBuffers: 0 }
            });
        });

        // Test 8: Negative maxNodes
        addTest('Negative maxNodes', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { maxNodes: -100 }
            });
        });

        // Test 9: Infinity value
        addTest('Infinity numBuffers', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { numBuffers: Infinity }
            });
        });

        // Test 10: NaN value
        addTest('NaN numBuffers', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { numBuffers: NaN }
            });
        });

        // Test 11: Valid configuration with defaults
        addValidTest('Valid default configuration', {
            workerBaseURL: 'dist/workers/',
            wasmBaseURL: 'dist/wasm/'
        });

        // Test 12: Valid configuration with custom values
        addValidTest('Valid custom configuration', {
            workerBaseURL: 'dist/workers/',
            wasmBaseURL: 'dist/wasm/',
            scsynthOptions: {
                numBuffers: 512,
                maxNodes: 256,
                realTimeMemorySize: 8192
            }
        });

        // Test 13: Valid bufLength = 128
        addValidTest('Valid bufLength = 128', {
            workerBaseURL: 'dist/workers/',
            wasmBaseURL: 'dist/wasm/',
            scsynthOptions: {
                bufLength: 128
            }
        });

        // Test 14: Valid preferredSampleRate = 0 (auto)
        addValidTest('Valid preferredSampleRate = 0', {
            workerBaseURL: 'dist/workers/',
            wasmBaseURL: 'dist/wasm/',
            scsynthOptions: {
                preferredSampleRate: 0
            }
        });

        // Test 15: Valid preferredSampleRate = 48000
        addValidTest('Valid preferredSampleRate = 48000', {
            workerBaseURL: 'dist/workers/',
            wasmBaseURL: 'dist/wasm/',
            scsynthOptions: {
                preferredSampleRate: 48000
            }
        });

        // Test 16: Invalid loadGraphDefs (negative)
        addTest('Negative loadGraphDefs', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { loadGraphDefs: -1 }
            });
        });

        // Test 17: Invalid loadGraphDefs (exceeds max)
        addTest('loadGraphDefs exceeds maximum', () => {
            new SuperSonic({
                workerBaseURL: 'dist/workers/',
                wasmBaseURL: 'dist/wasm/',
                scsynthOptions: { loadGraphDefs: 999 }
            });
        });

        // Test 18: Valid loadGraphDefs = 0
        addValidTest('Valid loadGraphDefs = 0', {
            workerBaseURL: 'dist/workers/',
            wasmBaseURL: 'dist/wasm/',
            scsynthOptions: {
                loadGraphDefs: 0
            }
        });

        // Test 19: Valid loadGraphDefs = 1
        addValidTest('Valid loadGraphDefs = 1', {
            workerBaseURL: 'dist/workers/',
            wasmBaseURL: 'dist/wasm/',
            scsynthOptions: {
                loadGraphDefs: 1
            }
        });
    </script>
</body>
</html>
